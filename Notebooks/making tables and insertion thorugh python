{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "5c11336b",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Saved c_user.csv\n",
      "Saved Movies.csv\n",
      "Saved Theaters.csv\n",
      "Saved Screens.csv\n",
      "Saved Shows.csv\n",
      "Saved Schedule.csv\n",
      "Saved Reciepts.csv\n",
      "Saved Bookings.csv\n",
      "Saved Seats.csv\n",
      "Saved Payments.csv\n",
      "Saved Reviews.csv\n"
     ]
    }
   ],
   "source": [
    "import pandas as pd\n",
    "\n",
    "# Path to your Excel file\n",
    "excel_file = \"BookMyShow_Dataset.xlsx\"\n",
    "\n",
    "# Load all sheets (specify engine)\n",
    "sheets = pd.read_excel(excel_file, sheet_name=None, engine=\"openpyxl\")\n",
    "\n",
    "# Loop through sheets and save each as CSV\n",
    "for sheet_name, df in sheets.items():\n",
    "    csv_file = f\"{sheet_name}.csv\"   # name file after the sheet\n",
    "    df.to_csv(csv_file, index=False) # save without row index\n",
    "    print(f\"Saved {csv_file}\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3ae9ae20",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ Inserted data from c_user.csv into table `c_user`\n",
      "‚úÖ Inserted data from Movies.csv into table `Movies`\n",
      "‚úÖ Inserted data from Theaters.csv into table `Theaters`\n",
      "‚úÖ Inserted data from Screens.csv into table `Screens`\n",
      "‚úÖ Inserted data from Shows.csv into table `Shows`\n",
      "‚úÖ Inserted data from Bookings.csv into table `Bookings`\n",
      "‚úÖ Inserted data from Seats.csv into table `Seats`\n",
      "‚úÖ Inserted data from Payments.csv into table `Payments`\n",
      "‚úÖ Inserted data from Reviews.csv into table `Reviews`\n",
      "‚úÖ Inserted data from Reciepts.csv into table `Reciepts`\n",
      "‚úÖ Inserted data from Schedule.csv into table `Schedule`\n",
      "üéâ All CSVs inserted into MySQL successfully!\n"
     ]
    }
   ],
   "source": [
    "import pymysql\n",
    "import pandas as pd\n",
    "import os\n",
    "\n",
    "# --- MySQL Connection ---\n",
    "con = pymysql.connect(\n",
    "    host=\"localhost\",       # or 127.0.0.1\n",
    "    user=\"root\",            # your MySQL username\n",
    "    password=\"\",  # your MySQL password\n",
    "    database=\"bookmyshow\"     # make sure this database already exists\n",
    ")\n",
    "cur = con.cursor()\n",
    "\n",
    "# --- List of CSV files ---\n",
    "csv_files = [\n",
    "    \"c_user.csv\",\"Movies.csv\",\"Theaters.csv\",\"Screens.csv\",\"Shows.csv\",\"Bookings.csv\",\"Seats.csv\",\"Payments.csv\",\"Reviews.csv\",\"Reciepts.csv\",\"Schedule.csv\"\n",
    "]\n",
    "\n",
    "# --- Loop through each CSV ---\n",
    "for file in csv_files:\n",
    "    # Load CSV into DataFrame\n",
    "    df = pd.read_csv(file)\n",
    "    \n",
    "    # Use filename (without extension) as table name\n",
    "    table_name = os.path.splitext(os.path.basename(file))[0]\n",
    "    \n",
    "    # Create table query (all VARCHAR for simplicity)\n",
    "    columns = \", \".join([f\"`{col}` VARCHAR(255)\" for col in df.columns])\n",
    "    create_query = f\"CREATE TABLE IF NOT EXISTS `{table_name}` ({columns});\"\n",
    "    cur.execute(create_query)\n",
    "    \n",
    "    # Insert data row by row\n",
    "    for _, row in df.iterrows():\n",
    "        placeholders = \", \".join([\"%s\"] * len(row))\n",
    "        insert_query = f\"INSERT INTO `{table_name}` VALUES ({placeholders})\"\n",
    "        cur.execute(insert_query, tuple(row))\n",
    "    \n",
    "    con.commit()\n",
    "    print(f\"‚úÖ Inserted data from {file} into table `{table_name}`\")\n",
    "\n",
    "# --- Close connection ---\n",
    "cur.close()\n",
    "con.close()\n",
    "print(\"üéâ All CSVs inserted into MySQL successfully!\")\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "f753961d",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "‚úÖ c_user: CHANGE COLUMN user_id user_id VARCHAR(20)\n",
      "‚úÖ c_user: CHANGE COLUMN name name VARCHAR(100)\n",
      "‚úÖ c_user: CHANGE COLUMN email email VARCHAR(100)\n",
      "‚úÖ c_user: CHANGE COLUMN phone_number phone_number VARCHAR(15)\n",
      "‚úÖ c_user: CHANGE COLUMN date_of_birth date_of_birth DATE\n",
      "‚úÖ Movies: CHANGE COLUMN movie_id movie_id VARCHAR(20)\n",
      "‚úÖ Movies: CHANGE COLUMN title title VARCHAR(200)\n",
      "‚úÖ Movies: CHANGE COLUMN genre genre VARCHAR(50)\n",
      "‚úÖ Movies: CHANGE COLUMN language language VARCHAR(50)\n",
      "‚úÖ Movies: CHANGE COLUMN duration duration INT\n",
      "‚úÖ Movies: CHANGE COLUMN rating rating FLOAT\n",
      "‚úÖ Movies: CHANGE COLUMN release_date release_date DATE\n",
      "‚úÖ Theaters: CHANGE COLUMN theater_id theater_id VARCHAR(20)\n",
      "‚úÖ Theaters: CHANGE COLUMN name name VARCHAR(200)\n",
      "‚úÖ Theaters: CHANGE COLUMN location location VARCHAR(200)\n",
      "‚úÖ Theaters: CHANGE COLUMN city city VARCHAR(100)\n",
      "‚úÖ Theaters: CHANGE COLUMN state state VARCHAR(100)\n",
      "‚úÖ Screens: CHANGE COLUMN screen_id screen_id VARCHAR(20)\n",
      "‚úÖ Screens: CHANGE COLUMN screen_number screen_number INT\n",
      "‚úÖ Screens: CHANGE COLUMN total_seats total_seats INT\n",
      "‚úÖ Shows: CHANGE COLUMN show_id show_id VARCHAR(20)\n",
      "‚úÖ Shows: CHANGE COLUMN show_date show_date DATE\n",
      "‚úÖ Shows: CHANGE COLUMN start_time start_time TIME\n",
      "‚úÖ Shows: CHANGE COLUMN price_per_ticket price_per_ticket FLOAT\n",
      "‚úÖ Shows: CHANGE COLUMN available_seats available_seats INT\n",
      "‚úÖ Schedule: CHANGE COLUMN Schedule_id Schedule_id VARCHAR(20)\n",
      "‚úÖ Schedule: CHANGE COLUMN show_id show_id VARCHAR(20)\n",
      "‚úÖ Schedule: CHANGE COLUMN movie_id movie_id VARCHAR(20)\n",
      "‚úÖ Schedule: CHANGE COLUMN theater_id theater_id VARCHAR(20)\n",
      "‚úÖ Schedule: CHANGE COLUMN screen_id screen_id VARCHAR(20)\n",
      "‚úÖ Bookings: CHANGE COLUMN booking_id booking_id VARCHAR(20)\n",
      "‚úÖ Bookings: CHANGE COLUMN booking_date booking_date DATETIME\n",
      "‚úÖ Bookings: CHANGE COLUMN total_tickets total_tickets INT\n",
      "‚úÖ Bookings: CHANGE COLUMN payment_status payment_status VARCHAR(20)\n",
      "‚úÖ Seats: CHANGE COLUMN seat_id seat_id VARCHAR(20)\n",
      "‚úÖ Seats: CHANGE COLUMN booking_id booking_id VARCHAR(20)\n",
      "‚úÖ Seats: CHANGE COLUMN screen_id screen_id VARCHAR(20)\n",
      "‚úÖ Seats: CHANGE COLUMN seat_number seat_number VARCHAR(10)\n",
      "‚úÖ Seats: CHANGE COLUMN seat_type seat_type VARCHAR(20)\n",
      "‚úÖ Seats: CHANGE COLUMN charges charges FLOAT\n",
      "‚úÖ Seats: CHANGE COLUMN status status VARCHAR(20)\n",
      "‚úÖ Payments: CHANGE COLUMN payment_id payment_id VARCHAR(20)\n",
      "‚úÖ Payments: CHANGE COLUMN payment_method payment_method VARCHAR(50)\n",
      "‚úÖ Payments: CHANGE COLUMN payment_date payment_date DATETIME\n",
      "‚úÖ Payments: CHANGE COLUMN transaction_status transaction_status VARCHAR(20)\n",
      "‚úÖ Reciepts: CHANGE COLUMN Reciept_id Reciept_id VARCHAR(20)\n",
      "‚úÖ Reciepts: CHANGE COLUMN booking_id booking_id VARCHAR(20)\n",
      "‚úÖ Reciepts: CHANGE COLUMN user_id user_id VARCHAR(20)\n",
      "‚úÖ Reciepts: CHANGE COLUMN show_id show_id VARCHAR(20)\n",
      "‚úÖ Reciepts: CHANGE COLUMN payment_id payment_id VARCHAR(20)\n",
      "‚úÖ Reviews: CHANGE COLUMN review_id review_id VARCHAR(20)\n",
      "‚úÖ Reviews: CHANGE COLUMN user_id user_id VARCHAR(20)\n",
      "‚úÖ Reviews: CHANGE COLUMN movie_id movie_id VARCHAR(20)\n",
      "‚úÖ Reviews: CHANGE COLUMN rating rating FLOAT\n",
      "‚úÖ Reviews: CHANGE COLUMN review_text review_text TEXT\n",
      "‚úÖ Reviews: CHANGE COLUMN review_date review_date DATETIME\n",
      "‚úÖ Primary key added to c_user.user_id\n",
      "‚úÖ Primary key added to Movies.movie_id\n",
      "‚úÖ Primary key added to Theaters.theater_id\n",
      "‚úÖ Primary key added to Screens.screen_id\n",
      "‚úÖ Primary key added to Shows.show_id\n",
      "‚úÖ Primary key added to Bookings.booking_id\n",
      "‚úÖ Primary key added to Seats.seat_id\n",
      "‚úÖ Primary key added to Payments.payment_id\n",
      "‚úÖ Primary key added to Reviews.review_id\n",
      "‚úÖ Primary key added to Reciepts.Reciept_id\n",
      "‚úÖ Primary key added to Schedule.Schedule_id\n",
      "‚úÖ Foreign key Schedule.show_id ‚Üí Shows.show_id\n",
      "‚úÖ Foreign key Schedule.movie_id ‚Üí Movies.movie_id\n",
      "‚úÖ Foreign key Schedule.theater_id ‚Üí Theaters.theater_id\n",
      "‚úÖ Foreign key Schedule.screen_id ‚Üí Screens.screen_id\n",
      "‚úÖ Foreign key Reciepts.booking_id ‚Üí Bookings.booking_id\n",
      "‚úÖ Foreign key Reciepts.user_id ‚Üí c_user.user_id\n",
      "‚úÖ Foreign key Reciepts.show_id ‚Üí Shows.show_id\n",
      "‚úÖ Foreign key Reciepts.payment_id ‚Üí Payments.payment_id\n",
      "‚úÖ Foreign key Seats.booking_id ‚Üí Bookings.booking_id\n",
      "‚úÖ Foreign key Seats.screen_id ‚Üí Screens.screen_id\n",
      "‚úÖ Foreign key Reviews.user_id ‚Üí c_user.user_id\n",
      "‚úÖ Foreign key Reviews.movie_id ‚Üí Movies.movie_id\n"
     ]
    }
   ],
   "source": [
    "import pymysql\n",
    "\n",
    "# ----------------------\n",
    "# Connect to MySQL\n",
    "# ----------------------\n",
    "conn = pymysql.connect(\n",
    "    host=\"localhost\",\n",
    "    user=\"root\",\n",
    "    password=\"010824@Symbi\",\n",
    "    database=\"bookmyshow\"\n",
    ")\n",
    "cur = conn.cursor()\n",
    "\n",
    "# ----------------------\n",
    "# Step 0: Fix Data Types\n",
    "# ----------------------\n",
    "dtype_fixes = {\n",
    "    \"c_user\": [\n",
    "        \"CHANGE COLUMN user_id user_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN name name VARCHAR(100)\",\n",
    "        \"CHANGE COLUMN email email VARCHAR(100)\",\n",
    "        \"CHANGE COLUMN phone_number phone_number VARCHAR(15)\",\n",
    "        \"CHANGE COLUMN date_of_birth date_of_birth DATE\"\n",
    "    ],\n",
    "    \"Movies\": [\n",
    "        \"CHANGE COLUMN movie_id movie_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN title title VARCHAR(200)\",\n",
    "        \"CHANGE COLUMN genre genre VARCHAR(50)\",\n",
    "        \"CHANGE COLUMN language language VARCHAR(50)\",\n",
    "        \"CHANGE COLUMN duration duration INT\",\n",
    "        \"CHANGE COLUMN rating rating FLOAT\",\n",
    "        \"CHANGE COLUMN release_date release_date DATE\"\n",
    "    ],\n",
    "    \"Theaters\": [\n",
    "        \"CHANGE COLUMN theater_id theater_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN name name VARCHAR(200)\",\n",
    "        \"CHANGE COLUMN location location VARCHAR(200)\",\n",
    "        \"CHANGE COLUMN city city VARCHAR(100)\",\n",
    "        \"CHANGE COLUMN state state VARCHAR(100)\"\n",
    "    ],\n",
    "    \"Screens\": [\n",
    "        \"CHANGE COLUMN screen_id screen_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN screen_number screen_number INT\",\n",
    "        \"CHANGE COLUMN total_seats total_seats INT\"\n",
    "    ],\n",
    "    \"Shows\": [\n",
    "        \"CHANGE COLUMN show_id show_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN show_date show_date DATE\",\n",
    "        \"CHANGE COLUMN start_time start_time TIME\",\n",
    "        \"CHANGE COLUMN price_per_ticket price_per_ticket FLOAT\",\n",
    "        \"CHANGE COLUMN available_seats available_seats INT\"\n",
    "    ],\n",
    "    \"Schedule\": [\n",
    "        \"CHANGE COLUMN Schedule_id Schedule_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN show_id show_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN movie_id movie_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN theater_id theater_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN screen_id screen_id VARCHAR(20)\"\n",
    "    ],\n",
    "    \"Bookings\": [\n",
    "        \"CHANGE COLUMN booking_id booking_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN booking_date booking_date DATETIME\",\n",
    "        \"CHANGE COLUMN total_tickets total_tickets INT\",\n",
    "        \"CHANGE COLUMN payment_status payment_status VARCHAR(20)\"\n",
    "    ],\n",
    "    \"Seats\": [\n",
    "        \"CHANGE COLUMN seat_id seat_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN booking_id booking_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN screen_id screen_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN seat_number seat_number VARCHAR(10)\",\n",
    "        \"CHANGE COLUMN seat_type seat_type VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN charges charges FLOAT\",\n",
    "        \"CHANGE COLUMN status status VARCHAR(20)\"\n",
    "    ],\n",
    "    \"Payments\": [\n",
    "        \"CHANGE COLUMN payment_id payment_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN payment_method payment_method VARCHAR(50)\",\n",
    "        \"CHANGE COLUMN payment_date payment_date DATETIME\",\n",
    "        \"CHANGE COLUMN transaction_status transaction_status VARCHAR(20)\"\n",
    "    ],\n",
    "    \"Reciepts\": [\n",
    "        \"CHANGE COLUMN Reciept_id Reciept_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN booking_id booking_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN user_id user_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN show_id show_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN payment_id payment_id VARCHAR(20)\"\n",
    "    ],\n",
    "    \"Reviews\": [\n",
    "        \"CHANGE COLUMN review_id review_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN user_id user_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN movie_id movie_id VARCHAR(20)\",\n",
    "        \"CHANGE COLUMN rating rating FLOAT\",\n",
    "        \"CHANGE COLUMN review_text review_text TEXT\",\n",
    "        \"CHANGE COLUMN review_date review_date DATETIME\"\n",
    "    ]\n",
    "}\n",
    "\n",
    "for table, queries in dtype_fixes.items():\n",
    "    for q in queries:\n",
    "        try:\n",
    "            cur.execute(f\"ALTER TABLE {table} {q};\")\n",
    "            print(f\"‚úÖ {table}: {q}\")\n",
    "        except Exception as err:\n",
    "            print(f\"‚ö†Ô∏è Error in {table} ({q}): {err}\")\n",
    "\n",
    "# ----------------------\n",
    "# Step 1: Primary Keys\n",
    "# ----------------------\n",
    "primary_keys = {\n",
    "    \"c_user\": \"user_id\",\n",
    "    \"Movies\": \"movie_id\",\n",
    "    \"Theaters\": \"theater_id\",\n",
    "    \"Screens\": \"screen_id\",\n",
    "    \"Shows\": \"show_id\",\n",
    "    \"Bookings\": \"booking_id\",\n",
    "    \"Seats\": \"seat_id\",\n",
    "    \"Payments\": \"payment_id\",\n",
    "    \"Reviews\": \"review_id\",\n",
    "    \"Reciepts\": \"Reciept_id\",\n",
    "    \"Schedule\": \"Schedule_id\"\n",
    "}\n",
    "\n",
    "for table, pk in primary_keys.items():\n",
    "    try:\n",
    "        cur.execute(f\"ALTER TABLE {table} ADD PRIMARY KEY ({pk});\")\n",
    "        print(f\"‚úÖ Primary key added to {table}.{pk}\")\n",
    "    except Exception as err:\n",
    "        print(f\"‚ö†Ô∏è Error adding PK on {table}.{pk}: {err}\")\n",
    "\n",
    "# ----------------------\n",
    "# Step 2: Foreign Keys\n",
    "# ----------------------\n",
    "foreign_keys = [\n",
    "    (\"Schedule\", \"show_id\", \"Shows\", \"show_id\"),\n",
    "    (\"Schedule\", \"movie_id\", \"Movies\", \"movie_id\"),\n",
    "    (\"Schedule\", \"theater_id\", \"Theaters\", \"theater_id\"),\n",
    "    (\"Schedule\", \"screen_id\", \"Screens\", \"screen_id\"),\n",
    "\n",
    "    (\"Reciepts\", \"booking_id\", \"Bookings\", \"booking_id\"),\n",
    "    (\"Reciepts\", \"user_id\", \"c_user\", \"user_id\"),\n",
    "    (\"Reciepts\", \"show_id\", \"Shows\", \"show_id\"),\n",
    "    (\"Reciepts\", \"payment_id\", \"Payments\", \"payment_id\"),\n",
    "\n",
    "    (\"Seats\", \"booking_id\", \"Bookings\", \"booking_id\"),\n",
    "    (\"Seats\", \"screen_id\", \"Screens\", \"screen_id\"),\n",
    "\n",
    "    (\"Reviews\", \"user_id\", \"c_user\", \"user_id\"),\n",
    "    (\"Reviews\", \"movie_id\", \"Movies\", \"movie_id\")\n",
    "]\n",
    "\n",
    "for child, col, parent, ref in foreign_keys:\n",
    "    try:\n",
    "        cur.execute(f\"\"\"\n",
    "            ALTER TABLE {child}\n",
    "            ADD CONSTRAINT fk_{child}_{col}\n",
    "            FOREIGN KEY ({col}) REFERENCES {parent}({ref});\n",
    "        \"\"\")\n",
    "        print(f\"‚úÖ Foreign key {child}.{col} ‚Üí {parent}.{ref}\")\n",
    "    except Exception as err:\n",
    "        print(f\"‚ö†Ô∏è Error adding FK {child}.{col}: {err}\")\n",
    "\n",
    "# ----------------------\n",
    "# Commit & Close\n",
    "# ----------------------\n",
    "conn.commit()\n",
    "cur.close()\n",
    "conn.close()\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "fdc7a866",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.10"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
